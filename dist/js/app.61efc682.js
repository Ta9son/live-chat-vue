(function(e){function t(t){for(var r,c,s=t[0],i=t[1],l=t[2],d=0,m=[];d<s.length;d++)c=s[d],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&m.push(o[c][0]),o[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);u&&u(t);while(m.length)m.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var i=n[s];0!==o[i]&&(r=!1)}r&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},o={app:0},a=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=i;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"07c1":function(e,t,n){},"11fb":function(e,t,n){"use strict";n("939a")},"355e":function(e,t,n){},"3d34":function(e,t,n){"use strict";n("355e")},"56d7":function(e,t,n){"use strict";n.r(t);n("e623"),n("e379"),n("5dc8"),n("37e1");var r=n("7a23");function o(e,t,n,o,a,c){var s=Object(r["z"])("router-view");return Object(r["s"])(),Object(r["d"])(s)}var a={},c=n("6b0d"),s=n.n(c);const i=s()(a,[["render",o]]);var l=i,u=n("1da1"),d=(n("96cf"),n("6c02")),m={class:"container welcome"},b=Object(r["g"])("p",null,"ようこそ",-1),p={key:0},g={class:"change-form"},h=Object(r["h"])("初めての方は"),f=Object(r["h"])("をクリック"),w={key:1},O={class:"change-form"},j=Object(r["h"])("アカウントをお持ちの方は"),v=Object(r["h"])("をクリック");function k(e,t,n,o,a,c){var s=Object(r["z"])("LoginForm"),i=Object(r["z"])("SignupForm");return Object(r["s"])(),Object(r["f"])("div",m,[b,a.shouldShowLoginForm?(Object(r["s"])(),Object(r["f"])("div",p,[Object(r["i"])(s,{onRedirectToChatRoom:c.redirectToChatRoom},null,8,["onRedirectToChatRoom"]),Object(r["g"])("p",g,[h,Object(r["g"])("span",{onClick:t[0]||(t[0]=function(e){return a.shouldShowLoginForm=!1})},"こちら"),f])])):Object(r["e"])("",!0),a.shouldShowLoginForm?Object(r["e"])("",!0):(Object(r["s"])(),Object(r["f"])("div",w,[Object(r["i"])(i,{onRedirectToChatRoom:c.redirectToChatRoom},null,8,["onRedirectToChatRoom"]),Object(r["g"])("p",O,[j,Object(r["g"])("span",{onClick:t[1]||(t[1]=function(e){return a.shouldShowLoginForm=!0})},"こちら"),v])]))])}var S=Object(r["g"])("h2",null,"ログイン",-1),C={class:"error"},y=Object(r["g"])("button",null,"ログインする",-1);function x(e,t,n,o,a,c){return Object(r["s"])(),Object(r["f"])("div",null,[S,Object(r["g"])("form",{onSubmit:t[2]||(t[2]=Object(r["H"])((function(){return c.login&&c.login.apply(c,arguments)}),["prevent"]))},[Object(r["F"])(Object(r["g"])("input",{type:"email",required:"",placeholder:"メールアドレス","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.email=e})},null,512),[[r["D"],a.email]]),Object(r["F"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"パスワード","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.password=e})},null,512),[[r["D"],a.password]]),Object(r["g"])("div",C,Object(r["B"])(a.error),1),y],32)])}n("d9e2"),n("b0c0");var R=n("bc3a"),I=n.n(R),_=function(e,t){window.localStorage.setItem("access-token",e["access-token"]),window.localStorage.setItem("client",e.client),window.localStorage.setItem("uid",e.uid),window.localStorage.setItem("name",t)},F=_,T={emits:["redirectToChatRoom"],data:function(){return{email:"",password:"",error:null}},methods:{login:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.error=null,t.next=4,I.a.post("http://localhost:3000/auth/sign_in",{email:e.email,password:e.password});case 4:if(n=t.sent,n){t.next=7;break}throw new Error("メールアドレスかパスワードが違います");case 7:return e.error||(F(n.headers,n.data.data.name),e.$emit("redirectToChatRoom")),console.log({res:n}),t.abrupt("return",n);case 12:t.prev=12,t.t0=t["catch"](0),console.log({error:t.t0}),e.error="メールアドレスかパスワードが違います";case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()}}};const L=s()(T,[["render",x]]);var B=L,U=Object(r["g"])("h2",null,"アカウントを作成",-1),D={class:"error"},E=Object(r["g"])("button",null,"登録する",-1);function $(e,t,n,o,a,c){return Object(r["s"])(),Object(r["f"])("div",null,[U,Object(r["g"])("form",{onSubmit:t[4]||(t[4]=Object(r["H"])((function(){return c.signUp&&c.signUp.apply(c,arguments)}),["prevent"]))},[Object(r["F"])(Object(r["g"])("input",{type:"text",required:"",placeholder:"名前","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.name=e})},null,512),[[r["D"],a.name]]),Object(r["F"])(Object(r["g"])("input",{type:"email",required:"",placeholder:"メールアドレス","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.email=e})},null,512),[[r["D"],a.email]]),Object(r["F"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"パスワード","onUpdate:modelValue":t[2]||(t[2]=function(e){return a.password=e})},null,512),[[r["D"],a.password]]),Object(r["F"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"パスワード(確認用)","onUpdate:modelValue":t[3]||(t[3]=function(e){return a.passwordConfirmation=e})},null,512),[[r["D"],a.passwordConfirmation]]),Object(r["g"])("div",D,Object(r["B"])(a.error),1),E],32)])}var M={emits:["redirectToChatRoom"],data:function(){return{name:"",email:"",password:"",passwordConfirmation:"",error:null}},methods:{signUp:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.error=null,t.prev=1,t.next=4,I.a.post("http://localhost:3000/auth",{name:e.name,email:e.email,password:e.password,password_confirmation:e.passwordConfirmation});case 4:if(n=t.sent,n){t.next=7;break}throw new Error("アカウントを登録できませんでした");case 7:return console.log({res:n}),e.error||(F(n.headers,n.data.data.name),e.$emit("redirectToChatRoom")),t.abrupt("return",n);case 12:t.prev=12,t.t0=t["catch"](1),e.error="アカウントを登録できませんでした";case 15:case"end":return t.stop()}}),t,null,[[1,12]])})))()}}};const W=s()(M,[["render",$]]);var z=W,P={components:{LoginForm:B,SignupForm:z},data:function(){return{shouldShowLoginForm:!0}},methods:{redirectToChatRoom:function(){this.$router.push({name:"Chatroom"})}}};n("e416");const V=s()(P,[["render",k]]);var q=V,H={class:"container"};function N(e,t,n,o,a,c){var s=Object(r["z"])("Navbar"),i=Object(r["z"])("ChatWindow"),l=Object(r["z"])("NewChatForm");return Object(r["s"])(),Object(r["f"])("div",H,[Object(r["i"])(s),Object(r["i"])(i,{onConnectCable:c.connectCable,messages:c.formattedMessages,ref:"chatWindow"},null,8,["onConnectCable","messages"]),Object(r["i"])(l,{onConnectCable:c.connectCable},null,8,["onConnectCable"])])}var J=n("5530"),G=(n("d81d"),Object(r["h"])("こんにちは、")),K={class:"name"},A=Object(r["h"])("さん"),Q={class:"email"},X={class:"error"};function Y(e,t,n,o,a,c){return Object(r["s"])(),Object(r["f"])("nav",null,[Object(r["g"])("div",null,[Object(r["g"])("p",null,[G,Object(r["g"])("span",K,Object(r["B"])(a.name),1),A]),Object(r["g"])("p",Q,"現在、"+Object(r["B"])(a.email)+" でログイン中です",1),Object(r["g"])("div",X,Object(r["B"])(a.error),1)]),Object(r["g"])("button",{onClick:t[0]||(t[0]=function(){return c.logout&&c.logout.apply(c,arguments)})},"ログアウト")])}var Z=function(){window.localStorage.removeItem("uid"),window.localStorage.removeItem("access-token"),window.localStorage.removeItem("client"),window.localStorage.removeItem("name")},ee=Z,te={data:function(){return{name:window.localStorage.getItem("name"),email:window.localStorage.getItem("uid"),error:null}},methods:{logout:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.error=null,t.prev=1,t.next=4,I.a.delete("http://localhost:3000/auth/sign_out",{headers:{uid:e.email,"access-token":window.localStorage.getItem("access-token"),client:window.localStorage.getItem("client")}});case 4:return n=t.sent,n||new Error("ログアウトできませんでした"),e.error||(console.log("ログアウトしました"),ee(),e.$router.push({name:"Welcome"})),t.abrupt("return",n);case 10:t.prev=10,t.t0=t["catch"](1),e.error="ログアウトできませんでした";case 13:case"end":return t.stop()}}),t,null,[[1,10]])})))()}}};n("3d34");const ne=s()(te,[["render",Y],["__scopeId","data-v-0c79f19d"]]);var re=ne,oe={class:"chat-window"},ae={key:0,class:"messages",ref:"messages"},ce={class:"name"},se=["onDblclick"],ie={key:0,class:"heart-container"},le={class:"heart-count"},ue={class:"created-at"};function de(e,t,n,o,a,c){var s=Object(r["z"])("font-awesome-icon");return Object(r["s"])(),Object(r["f"])("div",oe,[n.messages?(Object(r["s"])(),Object(r["f"])("div",ae,[(Object(r["s"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(n.messages,(function(e){return Object(r["s"])(),Object(r["f"])("ul",{key:e.id},[Object(r["g"])("li",{class:Object(r["o"])({received:e.email!==a.uid,sent:e.email===a.uid})},[Object(r["g"])("span",ce,Object(r["B"])(e.name),1),Object(r["g"])("div",{class:"message",onDblclick:function(t){return c.handleLike(e)}},[Object(r["h"])(Object(r["B"])(e.content)+" ",1),e.likes.length?(Object(r["s"])(),Object(r["f"])("div",ie,[Object(r["i"])(s,{icon:"heart",class:"heart"}),Object(r["g"])("span",le,Object(r["B"])(e.likes.length),1)])):Object(r["e"])("",!0)],40,se),Object(r["g"])("span",ue,Object(r["B"])(e.created_at)+"前",1)],2)])})),128))],512)):Object(r["e"])("",!0)])}var me={emits:["connectCable"],props:["messages"],data:function(){return{uid:window.localStorage.getItem("uid")}},methods:{handleLike:function(e){for(var t=0;t<e.likes.length;t++){var n=e.likes[t];if(n.email===this.uid)return void this.deleteLike(n.id,e.id)}this.createLike(e.id)},createLike:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,I.a.post("http://localhost:3000/messages/".concat(e,"/likes"),{},{headers:{uid:t.uid,"access-token":window.localStorage.getItem("access-token"),client:window.localStorage.getItem("client")}});case 3:r=n.sent,r||new Error("いいねできませんでした"),t.$emit("connectCable"),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),console.log(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},deleteLike:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,I.a.delete("http://localhost:3000/likes/".concat(e),{headers:{uid:t.uid,"access-token":window.localStorage.getItem("access-token"),client:window.localStorage.getItem("client")}});case 3:r=n.sent,r||new Error("いいねを削除できませんでした"),t.$emit("connectCable"),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),console.log(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},scrollToBottom:function(){var e=this.$refs.messages;e.scrollTop=e.scrollHeight}}};n("7ebb");const be=s()(me,[["render",de],["__scopeId","data-v-44e48272"]]);var pe=be;function ge(e,t,n,o,a,c){return Object(r["s"])(),Object(r["f"])("form",null,[Object(r["F"])(Object(r["g"])("textarea",{placeholder:"メッセージを入力してEnterを押してください","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.message=e}),onKeypress:t[1]||(t[1]=Object(r["G"])(Object(r["H"])((function(){return c.handleSubmit&&c.handleSubmit.apply(c,arguments)}),["prevent"]),["enter"]))},null,544),[[r["D"],a.message]])])}var he={emits:["connectCable"],data:function(){return{message:""}},methods:{handleSubmit:function(){this.$emit("connectCable",this.message),this.message=""}}};n("11fb");const fe=s()(he,[["render",ge],["__scopeId","data-v-6613dace"]]);var we=fe,Oe=n("f5ee"),je=n.n(Oe),ve=n("ef1b"),ke=n("25f0"),Se={components:{Navbar:re,ChatWindow:pe,NewChatForm:we},data:function(){return{messages:[]}},computed:{formattedMessages:function(){return this.messages.length?this.messages.map((function(e){var t=Object(ve["a"])(new Date(e.created_at),{locale:ke["a"]});return Object(J["a"])(Object(J["a"])({},e),{},{created_at:t})})):[]}},methods:{getMessages:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,I.a.get("http://localhost:3000/messages",{headers:{uid:window.localStorage.getItem("uid"),"access-token":window.localStorage.getItem("access-token"),client:window.localStorage.getItem("client")}});case 3:n=t.sent,n||new Error("メッセージ一覧を取得できませんでした"),e.messages=n.data,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},connectCable:function(e){this.messageChannel.perform("receive",{message:e,email:window.localStorage.getItem("uid")})}},mounted:function(){var e=this,t=je.a.createConsumer("ws://localhost:3000/cable");this.messageChannel=t.subscriptions.create("RoomChannel",{connected:function(){e.getMessages().then((function(){e.$refs.chatWindow.scrollToBottom()}))},received:function(){e.getMessages().then((function(){e.$refs.chatWindow.scrollToBottom()}))}})},beforeUnmount:function(){this.messageChannel.unsubscribe()}};const Ce=s()(Se,[["render",N]]);var ye=Ce,xe=Object(r["x"])(null),Re=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return xe.value=null,t=window.localStorage.getItem("uid"),n=window.localStorage.getItem("client"),r=window.localStorage.getItem("access-token"),e.prev=4,e.next=7,I.a.get("http://localhost:3000/auth/validate_token",{headers:{uid:t,"access-token":r,client:n}});case 7:if(o=e.sent,o){e.next=10;break}throw new Error("認証に失敗しました");case 10:return e.abrupt("return",o);case 13:e.prev=13,e.t0=e["catch"](4),xe.value="認証に失敗しました",ee();case 17:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}(),Ie=function(){return{error:xe,validate:Re}},_e=Ie,Fe=_e(),Te=Fe.error,Le=Fe.validate,Be=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,n,r){var o,a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=window.localStorage.getItem("uid"),a=window.localStorage.getItem("client"),c=window.localStorage.getItem("access-token"),o&&a&&c){e.next=7;break}return console.log("ログインしておりません"),r({name:"Welcome"}),e.abrupt("return");case 7:return e.next=9,Le();case 9:Te.value?(console.log("認証に失敗しました"),r({name:"Welcome"})):r();case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ue=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,n,r){var o,a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=window.localStorage.getItem("uid"),a=window.localStorage.getItem("client"),c=window.localStorage.getItem("access-token"),o||a||c){e.next=6;break}return r(),e.abrupt("return");case 6:return e.next=8,Le();case 8:Te.value?r():r({name:"Chatroom"});case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),De=[{path:"/",name:"Welcome",component:q,beforeEnter:Ue},{path:"/chatroom",name:"Chatroom",component:ye,beforeEnter:Be}],Ee=Object(d["a"])({history:Object(d["b"])("/"),routes:De}),$e=Ee,Me=(n("845f"),n("ad3d")),We=n("ecee"),ze=n("c074");We["c"].add(ze["a"]),Object(r["c"])(l).use($e).component("font-awesome-icon",Me["a"]).mount("#app")},"7ebb":function(e,t,n){"use strict";n("f99c")},"845f":function(e,t,n){},"939a":function(e,t,n){},e416:function(e,t,n){"use strict";n("07c1")},f99c:function(e,t,n){}});
//# sourceMappingURL=app.61efc682.js.map